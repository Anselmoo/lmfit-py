
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Frequently Asked Questions &#8212; Non-Linear Least-Squares Minimization and Curve-Fitting for Python</title>
    <link rel="stylesheet" href="_static/lmfitdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/@jupyter-widgets/html-manager@^0.14.0/dist/embed-amd.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Parameter and Parameters" href="parameters.html" />
    <link rel="prev" title="Getting Help" href="support.html" />
  <script type="text/x-mathjax-config">
     MathJax.Hub.Config({
        "TeX": {Macros: {AA : "{\\unicode{x212B}}"}},
        "HTML-CSS": {scale: 90}
  });</script>

  </head><body>
<div>
<table border=0>
  <tr><td></td><td width=80% padding=5 align=left>
          <a href="contents.html/../index.html" style="color: #157"> <font size=+3>LMFIT</font></a>
     </td>
     <td width=6% align=left>
         <a href="contents.html" style="color: #882222">
         <font size+=1>Contents</font></a> </td>
     <td width=6% align=left>
          <a href="examples/index.html" style="color: #882222">
          <font size+=1>Examples</font></a></td>
     <td width=6% align=left>
          <a href="installation.html" style="color: #882222">
          <font size+=1>Download</font></a></td>
     <td></td>
  </tr>
  <tr><td></td><td width=80% padding=5 align=left>
        <a href="contents.html/../index.html" style="color: #157"> <font size=+2>
	Non-Linear Least-Squares Minimization and Curve-Fitting for Python</font></a>
     </td>
     <td width=6% align=left>
         <a href="#" style="color: #882222">
         <font size+=1>FAQ</font></a> </td>
     <td width=6% align=left>
         <a href="support.html" style="color: #882222">
         <font size+=1>Support</font></a> </td>
     <td width=6% align=left>
        <a href="https://github.com/lmfit/lmfit-py/" style="color: #882222">
         <font size+=1>Develop</font></a></td>
     <td></td>
  </tr>
</table>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="parameters.html" title="Parameter and Parameters"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="support.html" title="Getting Help"
             accesskey="P">previous</a> |</li>
   <li>[<a href="intro.html">intro</a>|</li>
   <li><a href="parameters.html">parameters</a>|</li>
   <li><a href="fitting.html"> minimize</a>|</li>
   <li><a href="model.html"> model</a>|</li>
   <li><a href="builtin_models.html"> built-in models</a>|</li>
   <li><a href="confidence.html">confidence intervals</a>|</li>
   <li><a href="bounds.html">bounds</a>|</li>
   <li><a href="constraints.html">constraints</a>|</li>

      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Frequently Asked Questions</a><ul>
<li><a class="reference internal" href="#what-s-the-best-way-to-ask-for-help-or-submit-a-bug-report">What’s the best way to ask for help or submit a bug report?</a></li>
<li><a class="reference internal" href="#why-did-my-script-break-when-upgrading-from-lmfit-0-8-3-to-0-9-0">Why did my script break when upgrading from lmfit 0.8.3 to 0.9.0?</a></li>
<li><a class="reference internal" href="#i-get-import-errors-from-ipython">I get import errors from IPython</a></li>
<li><a class="reference internal" href="#how-can-i-fit-multi-dimensional-data">How can I fit multi-dimensional data?</a></li>
<li><a class="reference internal" href="#how-can-i-fit-multiple-data-sets">How can I fit multiple data sets?</a></li>
<li><a class="reference internal" href="#how-can-i-fit-complex-data">How can I fit complex data?</a></li>
<li><a class="reference internal" href="#can-i-constrain-values-to-have-integer-values">Can I constrain values to have integer values?</a></li>
<li><a class="reference internal" href="#how-should-i-cite-lmfit">How should I cite LMFIT?</a></li>
<li><a class="reference internal" href="#i-get-errors-from-nan-in-my-fit-what-can-i-do">I get errors from NaN in my fit.  What can I do?</a><ul>
<li><a class="reference internal" href="#nan-policy"><cite>nan_policy</cite></a></li>
<li><a class="reference internal" href="#common-sources-of-nan">Common sources of NaN</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="support.html"
                        title="previous chapter">Getting Help</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="parameters.html"
                        title="next chapter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code>  and <code class="xref py py-class docutils literal notranslate"><span class="pre">Parameters</span></code></a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/faq.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">

  <div class="section" id="frequently-asked-questions">
<span id="faq-chapter"></span><h1>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">¶</a></h1>
<p>A list of common questions.</p>
<div class="section" id="what-s-the-best-way-to-ask-for-help-or-submit-a-bug-report">
<h2>What’s the best way to ask for help or submit a bug report?<a class="headerlink" href="#what-s-the-best-way-to-ask-for-help-or-submit-a-bug-report" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference internal" href="support.html#support-chapter"><span class="std std-ref">Getting Help</span></a>.</p>
</div>
<div class="section" id="why-did-my-script-break-when-upgrading-from-lmfit-0-8-3-to-0-9-0">
<h2>Why did my script break when upgrading from lmfit 0.8.3 to 0.9.0?<a class="headerlink" href="#why-did-my-script-break-when-upgrading-from-lmfit-0-8-3-to-0-9-0" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference internal" href="whatsnew.html#whatsnew-090-label"><span class="std std-ref">Version 0.9.0 Release Notes</span></a></p>
</div>
<div class="section" id="i-get-import-errors-from-ipython">
<h2>I get import errors from IPython<a class="headerlink" href="#i-get-import-errors-from-ipython" title="Permalink to this headline">¶</a></h2>
<p>If you see something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.html.widgets</span> <span class="k">import</span> <span class="n">Dropdown</span>

<span class="ne">ImportError</span><span class="p">:</span> <span class="n">No</span> <span class="n">module</span> <span class="n">named</span> <span class="s1">&#39;widgets&#39;</span>
</pre></div>
</div>
<p>then you need to install the <code class="docutils literal notranslate"><span class="pre">ipywidgets</span></code> package, try:  <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">ipywidgets</span></code>.</p>
</div>
<div class="section" id="how-can-i-fit-multi-dimensional-data">
<h2>How can I fit multi-dimensional data?<a class="headerlink" href="#how-can-i-fit-multi-dimensional-data" title="Permalink to this headline">¶</a></h2>
<p>The fitting routines accept data arrays that are one-dimensional and double
precision.  So you need to convert the data and model (or the value
returned by the objective function) to be one-dimensional.  A simple way to
do this is to use <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.flatten.html">numpy.ndarray.flatten</a>, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">residual</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="o">....</span>
    <span class="n">resid</span> <span class="o">=</span> <span class="n">calculate_multidim_residual</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">resid</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="how-can-i-fit-multiple-data-sets">
<h2>How can I fit multiple data sets?<a class="headerlink" href="#how-can-i-fit-multiple-data-sets" title="Permalink to this headline">¶</a></h2>
<p>As above, the fitting routines accept data arrays that are one-dimensional
and double precision.  So you need to convert the sets of data and models
(or the value returned by the objective function) to be one-dimensional.  A
simple way to do this is to use <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.concatenate.html">numpy.concatenate</a>.  As an
example, here is a residual function to simultaneously fit two lines to two
different arrays.  As a bonus, the two lines share the ‘offset’ parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">fit_function</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dat1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dat2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">model1</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;slope1&#39;</span><span class="p">]</span>
    <span class="n">model2</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;slope2&#39;</span><span class="p">]</span>

    <span class="n">resid1</span> <span class="o">=</span> <span class="n">dat1</span> <span class="o">-</span> <span class="n">model1</span>
    <span class="n">resid2</span> <span class="o">=</span> <span class="n">dat2</span> <span class="o">-</span> <span class="n">model2</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">resid1</span><span class="p">,</span> <span class="n">resid2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="how-can-i-fit-complex-data">
<h2>How can I fit complex data?<a class="headerlink" href="#how-can-i-fit-complex-data" title="Permalink to this headline">¶</a></h2>
<p>As with working with multi-dimensional data, you need to convert your data
and model (or the value returned by the objective function) to be double
precision, floating point numbers. The simplest approach is to use
<a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.view.html">numpy.ndarray.view</a>, perhaps like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">residual</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="o">....</span>
    <span class="n">resid</span> <span class="o">=</span> <span class="n">calculate_complex_residual</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">resid</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternately, you can use the <code class="xref py py-class docutils literal notranslate"><span class="pre">lmfit.Model</span></code> class to wrap a fit function
that returns a complex vector. It will automatically apply the above
prescription when calculating the residual. The benefit to this method
is that you also get access to the plot routines from the ModelResult
class, which are also complex-aware.</p>
</div>
<div class="section" id="can-i-constrain-values-to-have-integer-values">
<h2>Can I constrain values to have integer values?<a class="headerlink" href="#can-i-constrain-values-to-have-integer-values" title="Permalink to this headline">¶</a></h2>
<p>Basically, no.  None of the minimizers in lmfit support integer
programming.  They all (I think) assume that they can make a very small
change to a floating point value for a parameters value and see a change in
the value to be minimized.</p>
</div>
<div class="section" id="how-should-i-cite-lmfit">
<h2>How should I cite LMFIT?<a class="headerlink" href="#how-should-i-cite-lmfit" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference external" href="https://dx.doi.org/10.5281/zenodo.11813">https://dx.doi.org/10.5281/zenodo.11813</a></p>
</div>
<div class="section" id="i-get-errors-from-nan-in-my-fit-what-can-i-do">
<h2>I get errors from NaN in my fit.  What can I do?<a class="headerlink" href="#i-get-errors-from-nan-in-my-fit-what-can-i-do" title="Permalink to this headline">¶</a></h2>
<p>The solvers used by lmfit use NaN (see
<a class="reference external" href="https://en.wikipedia.org/wiki/NaN">https://en.wikipedia.org/wiki/NaN</a>) values as signals that the calculation
cannot continue.  If any value in the residual array (typically
<cite>(data-model)*weight</cite>) is NaN, then calculations of chi-square or
comparisons with other residual arrays to try find a better fit will also
give NaN and fail. There is no sensible way for lmfit or any of the
optimization routines to know how to handle such NaN values.  They
indicate that numerical calculations are not sensible and must stop.</p>
<p>This means that if your objective function (if using <code class="docutils literal notranslate"><span class="pre">minimize</span></code>) or model
function (if using <code class="docutils literal notranslate"><span class="pre">Model</span></code>) generates a NaN, the fit will stop
immediately. If your objective or model function generates a NaN, you
really must handle that.</p>
<div class="section" id="nan-policy">
<h3><cite>nan_policy</cite><a class="headerlink" href="#nan-policy" title="Permalink to this headline">¶</a></h3>
<p>If you are using <code class="xref py py-class docutils literal notranslate"><span class="pre">lmfit.Model</span></code> and the NaN values come from your
data array and are meant to indicate missing values, or if you using
<code class="xref py py-func docutils literal notranslate"><span class="pre">lmfit.minimize()</span></code> with the same basic intention, then it might be
possible to get a successful fit in spite of the NaN values. To do this,
you can add a <code class="docutils literal notranslate"><span class="pre">nan_policy='omit'</span></code> argument to <code class="xref py py-func docutils literal notranslate"><span class="pre">lmfit.minimize()</span></code>, or
when creating a <code class="xref py py-class docutils literal notranslate"><span class="pre">lmfit.Model</span></code>, or when running
<code class="xref py py-meth docutils literal notranslate"><span class="pre">lmfit.Model.fit()</span></code>.</p>
<p>In order for this to be effective, the number of NaN values cannot ever
change during the fit.  If the NaN values come from the data and not the
calculated model, that should be the case.</p>
</div>
<div class="section" id="common-sources-of-nan">
<h3>Common sources of NaN<a class="headerlink" href="#common-sources-of-nan" title="Permalink to this headline">¶</a></h3>
<p>If you are seeing erros due to NaN values, you will need to figure out
where they are coming from and eliminate them.  It is sometimes difficult
to tell what causes NaN values.  Keep in mind that all values should be
assumed to be either scalar values or numpy arrays of double precision real
numbers when fitting.  Some of the most likely causes of NaNs are:</p>
<blockquote>
<div><ul class="simple">
<li><p>taking <code class="docutils literal notranslate"><span class="pre">sqrt(x)</span></code> or <code class="docutils literal notranslate"><span class="pre">log(x)</span></code> where <code class="docutils literal notranslate"><span class="pre">x</span></code> is negative.</p></li>
<li><p>doing <code class="docutils literal notranslate"><span class="pre">x**y</span></code> where <code class="docutils literal notranslate"><span class="pre">x</span></code> is negative.  Since <code class="docutils literal notranslate"><span class="pre">y</span></code> is real, there will
be a fractional component, and a negative number to a fractional
exponent is not a real number.</p></li>
<li><p>doing <code class="docutils literal notranslate"><span class="pre">x/y</span></code> where both <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> are 0.</p></li>
</ul>
</div></blockquote>
<p>If you use these very common constructs in your objective or model
function, you should take some caution for what values you are passing
these functions and operators.  Many special functions have similar
limitations and should also be viewed with some suspicion if NaNs are being
generated.</p>
<p>A related problem is the generation of Inf (Infinity in floating point),
which generally comes from <code class="docutils literal notranslate"><span class="pre">exp(x)</span></code> where <code class="docutils literal notranslate"><span class="pre">x</span></code> has values greater than 700
or so, so that the resulting value is greater than 1.e308.  Inf is only
slightly better than NaN. It will completely ruin the ability to do the
fit.  However, unlike NaN, it is also usually clear how to handle Inf, as
you probably won’t ever have values greater than 1.e308 and can therefore
(usually) safely clip the argument passed to <code class="docutils literal notranslate"><span class="pre">exp()</span></code> to be smaller than
about 700.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="parameters.html" title="Parameter and Parameters"
             >next</a> |</li>
        <li class="right" >
          <a href="support.html" title="Getting Help"
             >previous</a> |</li>
   <li>[<a href="intro.html">intro</a>|</li>
   <li><a href="parameters.html">parameters</a>|</li>
   <li><a href="fitting.html"> minimize</a>|</li>
   <li><a href="model.html"> model</a>|</li>
   <li><a href="builtin_models.html"> built-in models</a>|</li>
   <li><a href="confidence.html">confidence intervals</a>|</li>
   <li><a href="bounds.html">bounds</a>|</li>
   <li><a href="constraints.html">constraints</a>|</li>

      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Matthew Newville, Till Stensitzki, and others.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>
